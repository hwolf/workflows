name: Test

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            let now = new Date()
            let tag = "prd-" + now.toLocaleString("sv")
                .replaceAll("-", "")
                .replaceAll(":", "")
                .replaceAll(" ", "-")
            let message = "Deployed at " + now.toLocaleString("de", {
              timeZone: "CET",
              timeZoneName: "shortOffset" }) + " to " + "prd"
            let response = await github.rest.git.createTag({
              owner: context.repo.owner,
              repo: context.repo.repo,
              tag: tag,
              message: message,
              object: context.sha,
              type: "commit"
            })
            await github.rest.git.createRef({
              owner: context.repo.owner,
              repo: context.repo.repo,
              ref: "refs/tags/" + tag,
              sha: response.data.sha
            })
